<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BB Webhook Debug WebApp</title>

<style>
body {
  font-family: monospace;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}
.box {
  background: #020617;
  border: 1px solid #334155;
  border-radius: 6px;
  padding: 15px;
  margin-bottom: 20px;
}
button {
  padding: 8px 12px;
  margin: 4px;
  border: 0;
  border-radius: 4px;
  cursor: pointer;
}
.save { background: #16a34a; color: #fff; }
.minus { background: #dc2626; color: #fff; }
.plus { background: #22c55e; color: #000; }
pre {
  white-space: pre-wrap;
  word-break: break-word;
}
</style>
</head>

<body>

<h2>ðŸ§ª BB Webhook Debug WebApp</h2>

<div class="box">
<b>Webhook URL</b>
<pre id="webhook"></pre>
</div>

<div class="box">
<b>User Data</b><br>
Username: <span id="username">-</span><br>
Balance: <span id="balance">0</span><br><br>

<button class="minus" onclick="change(-5)">-5</button>
<button class="plus" onclick="change(5)">+5</button>
<button class="save" onclick="save()">Save Balance</button>
</div>

<div class="box">
<b>Last Request</b>
<pre id="requestBox">{}</pre>
</div>

<div class="box">
<b>Last Bot Response (JSON)</b>
<pre id="responseBox">{}</pre>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const webhookUrl = params.get("sync");

document.getElementById("webhook").innerText = webhookUrl;

let user = { balance: 0 };

// -------- GET LOAD --------
function load(){
  document.getElementById("requestBox").innerText =
    "GET " + webhookUrl;

  fetch(webhookUrl, {
    method: "GET",
    headers: { "Accept": "application/json" }
  })
  .then(r => r.json())
  .then(res => {
    document.getElementById("responseBox").innerText =
      JSON.stringify(res, null, 2);

    if(res.user){
      user.balance = res.user.balance;
      document.getElementById("username").innerText = res.user.username;
      document.getElementById("balance").innerText = user.balance;
    }
  })
  .catch(err => {
    document.getElementById("responseBox").innerText = err.toString();
  });
}

// -------- POST SAVE --------
function save(){
  let payload = { action: "save", balance: user.balance };

  document.getElementById("requestBox").innerText =
    JSON.stringify(payload, null, 2);

  fetch(webhookUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(res => {
    document.getElementById("responseBox").innerText =
      JSON.stringify(res, null, 2);
  });
}

function change(v){
  user.balance += v;
  document.getElementById("balance").innerText = user.balance;
}

// auto-load
load();
</script>

</body>
</html>
