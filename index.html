<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Balance WebApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body { font-family:sans-serif; padding:20px; }
.btn { padding:10px 15px; margin:5px; border:none; border-radius:4px; color:#fff; cursor:pointer; }
.dec { background:#dc3545; }
.inc { background:#28a745; }
.save { background:#007bff; }
</style>
</head>

<body>
  <h2>Hello <span id="name"></span></h2>
  <h3>Balance: <span id="bal">0</span></h3>

  <button class="btn dec" onclick="change(-5)">-5</button>
  <button class="btn inc" onclick="change(5)">+5</button>

  <button class="btn save" onclick="save()">Save Balance</button>

<script>

Telegram.WebApp.ready();

let url = new URL(window.location.href);
let sync = url.searchParams.get("sync");

let state = { name:"", balance:0 };

function load(){
  fetch(sync, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ action:"load" })
  })
  .then(r=>r.json())
  .then(d=>{
    state.name = d.user.name;
    state.balance = d.user.balance;
    document.getElementById("name").textContent = state.name;
    document.getElementById("bal").textContent = state.balance;
  });
}

function change(v){
  state.balance += v;
  document.getElementById("bal").textContent = state.balance;
}

function save(){
  fetch(sync, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ action:"save", balance: state.balance })
  })
  .then(r=>r.json())
  .then(d=>{
    Telegram.WebApp.showAlert("Saved!");
  });
}

load();

</script>
</body>
</html>
