<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>My WebApp</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .box { max-width: 400px; margin: auto; background: #fff;
           padding: 20px; border-radius: 6px; box-shadow: 0 2px 5px #0003; }
    button { padding: 10px 20px; margin: 5px; border: 0; border-radius: 4px;
             cursor: pointer; }
    .save { background: #28a745; color: white; }
    .minus { background: #dc3545; color: white; }
    .plus { background: #007bff; color: white; }
  </style>
</head>

<body>
<div class="box">
  <h2 id="title">Loading WebApp...</h2>
  <p><b>User:</b> <span id="user"></span></p>
  <p><b>Balance:</b> <span id="balance"></span></p>

  <button class="minus" onclick="change(-5)">-5</button>
  <button class="plus" onclick="change(5)">+5</button>
  <br>
  <button class="save" onclick="save()">Save</button>
</div>

<script>
// --- Get values from query params ---
let params = new URL(window.location.href).searchParams;

let webhookUrl = params.get("sync");  // bot-generated personal webhook
let botName = params.get("bot") || "MyBot";

document.getElementById("title").innerText = botName + " WebApp";

let user = { username: "", balance: 0 };

// Load data via GET from webhook
function loadData(){
  fetch(webhookUrl)
    .then(r => r.json())
    .then(data => {
      user.username = data.user.username;
      user.balance = data.user.balance;

      document.getElementById("user").innerText = user.username;
      document.getElementById("balance").innerText = user.balance;
    })
    .catch(err => console.error("GET error:", err));
}

function change(amount){
  user.balance = parseInt(user.balance) + amount;
  document.getElementById("balance").innerText = user.balance;
}

// SAVE: POST back to webhook
function save(){
  fetch(webhookUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ balance: user.balance })
  })
  .then(() => alert("Saved to bot!"))
  .catch(err => console.error("POST error:", err));
}

loadData();
</script>
</body>
</html>
