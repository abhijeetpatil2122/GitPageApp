<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Balance App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body { 
  font-family: sans-serif;
  padding:20px; 
  text-align:center;
}
.btn { 
  padding:10px 20px; 
  margin:5px;
  border:none;
  background:#007bff; 
  color:white;
  border-radius:6px;
}
</style>
</head>

<body>
<h2>Hello <span id="name"></span></h2>
<h1>Balance: <span id="bal">0</span></h1>

<div>
  <button class="btn" onclick="change(-5)">-5</button>
  <button class="btn" onclick="change(5)">+5</button>
</div>

<div>
  <button class="btn" onclick="save()">Save</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

let sync = new URL(location.href).searchParams.get("sync");
let balance = 0;

function load(){
  fetch(sync, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ action:"load" })
  })
  .then(r=>r.json())
  .then(d=>{
    document.getElementById("name").textContent = d.user.first_name || "User";
    balance = d.user.balance;
    document.getElementById("bal").textContent = balance;
  });
}

function change(v){
  balance += v;
  document.getElementById("bal").textContent = balance;
}

function save(){
  fetch(sync, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ action:"save", balance })
  })
  .then(r=>r.json())
  .then(d=>{
    tg.showAlert("Saved!");
  });
}

load();
</script>

</body>
</html>
